# Сайт + кабинет для управления Lineage2 java серверами

Проект закрыт 2019.10.13<br>
В этом репозитории оставляю самую последнюю версию цмс.

## Установка:
- скачать архив или воспользоваться git clone<br>
- распаковать на ваш веб сервер<br>
- открыть в браузере, далее делать всё как там написано

## Режим разработчика
- В файле /public/index.php на 23 строке добавьте свой IP в массив.
Появится профайлер внизу страницы, отключится кэщ и будет доступен gii

## Разное
- Темы находятся в папке /themes/ Что-бы создать свою, надо скопировать ghtweb и сохранить с другим именем
- Логи (ошибки, нотисы и т.д) находятся в папке /protected/runtime/application.log
- Веб сервер должен смотреть в папку /public

# Дополнительно

## Требования:
- Apache2
- mod_rewrite, mod_headers
- PHP 7.4
- php-pdo
- php-mysql
- php-mbstring
- php-gd
- php-xml
- современная (IV квартал 2022 года) версия MySQL/MariaDB

## Обновления и дополнения
- Фреймворк Yii обновлен с 1.1.21 до 1.1.26, что теоретически позволяет обновить PHP до 8.1, но фактически приводит ко множеству deprecation warnings
- Поскольку, начиная с PHP 7.2, модуль mcrypt был удален из ядра по старости, он был заменен пакетом mcrypt_compat, установленным посредством Composer
- Добавлены иконки предметов
- Добавлена дополнительная тема из шары

## Проблемы и решения
- если появляются ошибки 404, проверить AllowOverride для директории public/ -- должно быть All
- Пароль пользователя БД должен быть задан с использованием плагина [mysql_native_password](https://mariadb.com/kb/en/authentication-plugin-mysql_native_password/)
- Таблицы в БД почему-то не создаются установщиком с первого раза, поэтому если на "Шаг 3, установка таблиц в БД" не будет списка таблиц, нужно просто нажать "Назад" в барузере, заполнить все еще раз и заново запустить процесс, либо выполнить миграции вручную
- При использовании обратного прокси-сервера с терминированием на нем HTTPS важно передавать схему в заголовке X-Forwarded-Proto, например (для nginx):
```
    location / {
        proxy_pass http://192.168.1.105;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  
    }
```
- Дату старта сервера для счетчика обратного отсчета можно указать в файле themes/ghtweb/views/layouts/master.php (внизу)
